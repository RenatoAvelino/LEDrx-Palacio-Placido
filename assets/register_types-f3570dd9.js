import{serializable as l,RectTransform as wt,Behaviour as h,Mathf as w,GameObject as y,OrbitControls as We,Text as ee,NeedleXRSession as Ve,getTempVector as P,Camera as vt,serializeable as f,WebXR as _t,setWorldPosition as J,Rigidbody as R,AudioSource as ge,InstantiateOptions as xt,Renderer as V,InstancingUtil as Ot,LODGroup as Pt,Volume as Ct,getWorldPosition as de,getParam as N,Gizmos as ze,ParticleSystem as Ne,setParamWithoutReload as jt,EventList as v,setWorldQuaternion as $e,getWorldQuaternion as Ae,Animator as Ue,WebXRImageTracking as St,syncField as U,showBalloonMessage as j,RoomEvents as ye,delay as z,Animation as be,isDevEnvironment as K,SceneSwitcher as Dt,Collider as te,LogType as Et,WaitForSeconds as Rt,ClearFlags as Mt,RGBAColor as Tt,logHierarchy as Ie,getTempQuaternion as He,AnimationCurve as $t,AssetReference as At,NeedleXRController as Le,XRControllerFollow as It,delayForFrames as Xe,MeshRenderer as Lt,ParticleSystemShapeType as pe,isDestroyed as Ge,instantiate as Bt,TypeStore as p}from"./needle-engine-bc22664e.js";import{V as I,P as Ft,O as T,C as Z,M as Wt,a as qe,b as M,c as Vt,d as we,Q as W,S as zt,A as Nt}from"./three.module-4af0aadb.js";import"./index-c8de8379.js";var Ut=Object.defineProperty,Ht=Object.getOwnPropertyDescriptor,Qe=(r,e,s,i)=>{for(var t=i>1?void 0:i?Ht(e,s):e,o=r.length-1,n;o>=0;o--)(n=r[o])&&(t=(i?n(e,s,t):n(t))||t);return i&&t&&Ut(e,s,t),t};class ve extends h{constructor(){super(...arguments),this.safeArea=new I(0,0)}update(){var t,o;const e=this.context.domWidth/this.safeArea.x,s=this.context.domHeight/this.safeArea.y,i=w.clamp(Math.min(e,s),0,1);(o=(t=this.rectTransform)==null?void 0:t.shadowComponent)==null||o.scale.setScalar(i)}}Qe([l(wt)],ve.prototype,"rectTransform",2);Qe([l(I)],ve.prototype,"safeArea",2);var Xt=Object.defineProperty,Gt=Object.getOwnPropertyDescriptor,_e=(r,e,s,i)=>{for(var t=i>1?void 0:i?Gt(e,s):e,o=r.length-1,n;o>=0;o--)(n=r[o])&&(t=(i?n(e,s,t):n(t))||t);return i&&t&&Xt(e,s,t),t};class se extends h{constructor(){super(...arguments),this.createMenuButton=!1,this.teleportVRPlayer=!1,this.ignoreYInVR=!1,this.menuButton=null}get orbitalCamera(){return this._orbitalCamera??(this._orbitalCamera=y.findObjectOfType(We)),this._orbitalCamera}awake(){this.createMenuButton&&this.addButton()}addButton(){var i;this.menuButton&&this.removeButton();const e=((i=this.gameObject.getComponentInChildren(ee))==null?void 0:i.text)??this.gameObject.name,s=document.createElement("button");this.menuButton=s,s.innerText=e.replace("_"," "),s.setAttribute("priority","40"),s.addEventListener("click",()=>this.use()),this.context.menu.appendChild(s)}removeButton(){this.menuButton&&(this.menuButton.remove(),this.menuButton=null)}use(){var s,i;(s=this.orbitalCamera)==null||s.setCameraTargetPosition(this.worldPosition);const e=(i=Ve.active)==null?void 0:i.rig;if(this.teleportVRPlayer&&this.context.isInVR&&e){const t=P(this.worldPosition);this.ignoreYInVR&&(t.y=e.gameObject.worldPosition.y),e.gameObject.worldPosition=t}}}_e([l()],se.prototype,"createMenuButton",2);_e([l()],se.prototype,"teleportVRPlayer",2);_e([l()],se.prototype,"ignoreYInVR",2);class qt extends h{constructor(){super(...arguments),this.cam=null}onEnable(){this.cam=this.gameObject.getComponent(vt),this.cam||(console.warn("CameraLayer requires a Camera component"),this.enabled=!1)}onAfterRender(){if(!this.cam)return;const e=this.scene.background;this.context.renderer.autoClearColor=!1,this.cam.cam instanceof Ft&&this.context.updateAspect(this.cam.cam),this.scene.background=null,this.context.renderer.render(this.scene,this.cam.cam),this.scene.background=e}}var Qt=Object.defineProperty,Yt=Object.getOwnPropertyDescriptor,ie=(r,e,s,i)=>{for(var t=i>1?void 0:i?Yt(e,s):e,o=r.length-1,n;o>=0;o--)(n=r[o])&&(t=(i?n(e,s,t):n(t))||t);return i&&t&&Qt(e,s,t),t};class H extends h{constructor(){super(...arguments),this.strength=10,this.maxInstances=10,this._instances=[],this._index=-1,this._onPointerDown=e=>{e.button===0&&this.throwBall(e.space.worldPosition,e.space.worldForward)}}start(){this.prefab&&y.setActive(this.prefab,!1),this.webXR??(this.webXR=y.findObjectOfType(_t))}onEnable(){this.context.input.addEventListener("pointerdown",this._onPointerDown)}onDisable(){this.context.input.removeEventListener("pointerdown",this._onPointerDown)}throwBall(e,s){var n,c;if(!this.prefab)return;if(this._instances.length<this.maxInstances){const u=new xt;u.position=e;const g=y.instantiate(this.prefab,u);if(!g)return;this._instances.push(g)}const i=++this._index,t=this._instances[i%this._instances.length];if(!t)return;J(t,e),y.setActive(t,!0),(n=this.audioSource)==null||n.stop(),(c=this.audioSource)==null||c.play();const o=y.getComponent(t,R);o&&(s.multiplyScalar(this.strength),o.resetForcesAndTorques(),o.resetVelocities(),o==null||o.applyImpulse(s))}}ie([f(T)],H.prototype,"prefab",2);ie([f(ge)],H.prototype,"audioSource",2);ie([f()],H.prototype,"strength",2);ie([f()],H.prototype,"maxInstances",2);var Jt=Object.defineProperty,Kt=Object.getOwnPropertyDescriptor,Ye=(r,e,s,i)=>{for(var t=i>1?void 0:i?Kt(e,s):e,o=r.length-1,n;o>=0;o--)(n=r[o])&&(t=(i?n(e,s,t):n(t))||t);return i&&t&&Jt(e,s,t),t};class xe extends h{constructor(){super(...arguments),this.applyOnStart=!0,this.randomMetallicRoughness=!0}start(){{const e=this.gameObject.getComponent(V);if(!e)return;for(let s=0;s<e.sharedMaterials.length;s++)e.sharedMaterials[s]=e.sharedMaterials[s].clone()}this.applyOnStart&&this.applyRandomColor()}applyRandomColor(){const e=this.gameObject.getComponent(V);if(!e){console.warn("Can not change color: No renderer on "+this.name);return}for(let s=0;s<e.sharedMaterials.length;s++){const i=e.sharedMaterials[s];i.color=new Z(Math.random(),Math.random(),Math.random()),this.randomMetallicRoughness&&i instanceof Wt&&(i.metalness=Math.random(),i.roughness=Math.random()*Math.random()),i.needsUpdate=!0,Ot.markDirty(this.gameObject)}}}Ye([f()],xe.prototype,"applyOnStart",2);Ye([f()],xe.prototype,"randomMetallicRoughness",2);class Zt extends h{constructor(){super(...arguments),this.renderer=null,this.collisionCount=0}start(){if(this.renderer=this.gameObject.getComponent(V),!!this.renderer){this._startColor||(this._startColor=[]);for(let e=0;e<this.renderer.sharedMaterials.length;e++)this.renderer.sharedMaterials[e]=this.renderer.sharedMaterials[e].clone(),this._startColor[e]=this.renderer.sharedMaterials[e].color.clone()}}onCollisionEnter(e){if(this.renderer){this.collisionCount+=1;for(let s=0;s<this.renderer.sharedMaterials.length;s++)this.renderer.sharedMaterials[s].color.setRGB(Math.random(),Math.random(),Math.random())}}onCollisionExit(e){if(!(!this.renderer||!this._startColor)&&(this.collisionCount-=1,this.collisionCount===0))for(let s=0;s<this.renderer.sharedMaterials.length;s++)this.renderer.sharedMaterials[s].color.copy(this._startColor[s])}}var kt=Object.defineProperty,es=Object.getOwnPropertyDescriptor,ts=(r,e,s,i)=>{for(var t=i>1?void 0:i?es(e,s):e,o=r.length-1,n;o>=0;o--)(n=r[o])&&(t=(i?n(e,s,t):n(t))||t);return i&&t&&kt(e,s,t),t};class Je extends h{update(){this.myMaterial&&(this.myMaterial._Speed*=1+this.context.time.deltaTime,this.myMaterial._Speed>1&&(this.myMaterial._Speed=5e-4),this.context.time.frame%30===0&&console.log(this.myMaterial._Speed))}}ts([l(qe)],Je.prototype,"myMaterial",2);var ss=Object.defineProperty,is=Object.getOwnPropertyDescriptor,Ke=(r,e,s,i)=>{for(var t=i>1?void 0:i?is(e,s):e,o=r.length-1,n;o>=0;o--)(n=r[o])&&(t=(i?n(e,s,t):n(t))||t);return i&&t&&ss(e,s,t),t};class Oe extends h{constructor(){super(...arguments),this.tempVec1=new M,this.tempVec2=new M}update(){if(!this.lodGroup||!this.text)return;const e=this.context.mainCamera;e.getWorldPosition(this.tempVec1),this.gameObject.getWorldPosition(this.tempVec2);const s=this.tempVec1.distanceTo(this.tempVec2)/e.zoom,i=this.lodGroup._lodsHandler;let t=null;i==null||i.forEach(o=>{var g,x;const n=o.levels[o.getCurrentLevel()],c=o.levels.at(o.getCurrentLevel()+1);let u=null;if(n.object instanceof Vt){const d=n.object.geometry.attributes,S=Math.floor(((g=d.position)==null?void 0:g.count)||0);u=`Triangles: ${Math.floor((((x=d.index)==null?void 0:x.count)||S)/3)}, Vertices: ${S}`}n.object.name.replace(/_/g,""),n.object.name.includes("Cull")||(t="",u&&(t+=`${u}
`),c==null||c.hysteresis,t+=`${n.distance.toFixed(1)} / ${s.toFixed(1)}`,c&&(t+=` / ${(c.distance-c.distance*c.hysteresis).toFixed(1)}`))}),t||(t="culled"),this.text.text=t}}Ke([l(Pt)],Oe.prototype,"lodGroup",2);Ke([l(ee)],Oe.prototype,"text",2);var os=Object.defineProperty,ns=Object.getOwnPropertyDescriptor,Pe=(r,e,s,i)=>{for(var t=i>1?void 0:i?ns(e,s):e,o=r.length-1,n;o>=0;o--)(n=r[o])&&(t=(i?n(e,s,t):n(t))||t);return i&&t&&os(e,s,t),t};class oe extends h{constructor(){super(...arguments),this.apertureMultiplier=2,this.focalLength=.001,this.focusDistanceCutoff=25,this.volume=null,this.dofEffect=void 0}onEnable(){var e,s,i;this.volume=y.findObjectOfType(Ct),this.dofEffect=(i=(s=(e=this.volume)==null?void 0:e.sharedProfile)==null?void 0:s.components)==null?void 0:i.find(t=>t.typeName==="DepthOfField"),this.orbit=y.findObjectOfType(We)}onBeforeRender(){var s;if(!((s=this.orbit)!=null&&s.controls))return;const e=this.orbit.controls.target.distanceTo(de(this.orbit.gameObject));if(this.dofEffect){this.dofEffect.focusDistance.value=e,this.dofEffect.focalLength.value=this.focalLength;let i=w.inverseLerp(0,this.focusDistanceCutoff,e);i=w.clamp01(i),this.dofEffect.aperture.value=w.lerp(this.apertureMultiplier,32,i);const t=this.focusDistanceCutoff;e>t&&this.dofEffect.active?this.dofEffect.active=!1:e<t&&!this.dofEffect.active&&(this.dofEffect.active=!0)}}}Pe([l()],oe.prototype,"apertureMultiplier",2);Pe([l()],oe.prototype,"focalLength",2);Pe([l()],oe.prototype,"focusDistanceCutoff",2);class rs extends h{constructor(){super(...arguments),this._previousEnvironmentTexture=null}onEnable(){this._previousEnvironmentTexture=this.context.scene.environment,this.context.scene.environment=null}onDisable(){this.context.scene.environment=this._previousEnvironmentTexture}}var as=Object.defineProperty,ls=Object.getOwnPropertyDescriptor,cs=(r,e,s,i)=>{for(var t=i>1?void 0:i?ls(e,s):e,o=r.length-1,n;o>=0;o--)(n=r[o])&&(t=(i?n(e,s,t):n(t))||t);return i&&t&&as(e,s,t),t};const hs=N("sample_debugParticlesOnClick");class Ze extends h{constructor(){super(...arguments),this.particleSystems=[]}update(){if(!this.context.isInVR&&this.context.input.getPointerClicked(0)){const e=this.context.physics.raycast();e.length>0&&this.spawnParticlesAt(e[0].point)}}onUpdateXR(e){e.xr.controllers.forEach(s=>{var i,t;if(((i=s.getButton("primary"))==null?void 0:i.isDown)===!0){const o=(t=this.context.physics.raycastFromRay(s.ray))==null?void 0:t.at(0);o&&this.spawnParticlesAt(o.point)}})}spawnParticlesAt(e){J(this.gameObject,e),hs&&ze.DrawWireSphere(e,.5,16711680,1);for(const s of this.particleSystems)s&&(y.setActive(s.gameObject,!0),s.play())}}cs([f(Ne)],Ze.prototype,"particleSystems",2);var ps=Object.defineProperty,ds=Object.getOwnPropertyDescriptor,ms=(r,e,s,i)=>{for(var t=i>1?void 0:i?ds(e,s):e,o=r.length-1,n;o>=0;o--)(n=r[o])&&(t=(i?n(e,s,t):n(t))||t);return i&&t&&ps(e,s,t),t};class ke extends h{constructor(){super(...arguments),this.parameters=[]}awake(){var e=!1;this.parameters.forEach(s=>{N(s)||(jt(s,""),e=!0)}),e&&window.location.reload()}}ms([l()],ke.prototype,"parameters",2);var us=Object.defineProperty,fs=Object.getOwnPropertyDescriptor,et=(r,e,s,i)=>{for(var t=i>1?void 0:i?fs(e,s):e,o=r.length-1,n;o>=0;o--)(n=r[o])&&(t=(i?n(e,s,t):n(t))||t);return i&&t&&us(e,s,t),t};class Ce extends h{constructor(){super(...arguments),this.htmlSelector="button.some-button",this.onClick=new v,this.onClicked=()=>{this.onClick.invoke()}}onEnable(){this.element=document.querySelector(this.htmlSelector),this.element?this.element.addEventListener("click",this.onClicked):console.warn(`Could not find element with selector "${this.htmlSelector}"`)}onDisable(){this.element&&this.element.removeEventListener("click",this.onClicked)}}et([f()],Ce.prototype,"htmlSelector",2);et([l(v)],Ce.prototype,"onClick",2);var gs=Object.defineProperty,ys=Object.getOwnPropertyDescriptor,tt=(r,e,s,i)=>{for(var t=i>1?void 0:i?ys(e,s):e,o=r.length-1,n;o>=0;o--)(n=r[o])&&(t=(i?n(e,s,t):n(t))||t);return i&&t&&gs(e,s,t),t};const st=class extends h{onEnable(){var r;if(!(!this.methods||!this.names)){console.log("HTMLMenu.onEnable"),this.wrapper=document.createElement("ul"),this.wrapper.classList.add("needle-menu");for(let e=0;e<this.methods.length;e++){const s=this.methods[e];let i="Button";e<((r=this.names)==null?void 0:r.length)&&(i=this.names[e]);const t=document.createElement("li"),o=document.createElement("button");o.innerHTML=i,o.onclick=()=>{s.invoke()},t.appendChild(o),this.wrapper.appendChild(t)}this.styleElement=document.createElement("style"),this.styleElement.innerHTML=st.style,document.head.appendChild(this.styleElement),this.context.domElement.appendChild(this.wrapper)}}onDisable(){this.wrapper&&(this.wrapper.remove(),this.wrapper=void 0),this.styleElement&&(this.styleElement.remove(),this.styleElement=void 0)}};let ne=st;ne.style=`
        .needle-menu {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 100;
            list-style-type: none;
            margin: 0;
            overflow: hidden;
            background-color: white;
            display: flex;
            padding: 5px;
            border-radius: 20px;
        }

        .needle-menu li button {
            padding: 5px;
            margin: 0 5px;
            background: none;
            outline: none;
            border: 0;
            cursor: pointer;
        }

        .needle-menu li button:hover {
            font-weight: bold;
        }
    `;tt([l(v)],ne.prototype,"methods",2);tt([l()],ne.prototype,"names",2);const Be=new M,bs=new W,Fe=new M;class ws extends T{constructor(e=document.createElement("div")){super(),this.isCSS3DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.addEventListener("removed",function(){this.traverse(function(s){s.element instanceof Element&&s.element.parentNode!==null&&s.element.parentNode.removeChild(s.element)})})}copy(e,s){return super.copy(e,s),this.element=e.element.cloneNode(!0),this}}const E=new we,vs=new we;class _s{constructor(e={}){const s=this;let i,t,o,n;const c={camera:{style:""},objects:new WeakMap},u=e.element!==void 0?e.element:document.createElement("div");u.style.overflow="hidden",this.domElement=u;const g=document.createElement("div");g.style.transformOrigin="0 0",g.style.pointerEvents="none",u.appendChild(g);const x=document.createElement("div");x.style.transformStyle="preserve-3d",g.appendChild(x),this.getSize=function(){return{width:i,height:t}},this.render=function(m,a){const O=a.projectionMatrix.elements[5]*n;a.view&&a.view.enabled?(g.style.transform=`translate( ${-a.view.offsetX*(i/a.view.width)}px, ${-a.view.offsetY*(t/a.view.height)}px )`,g.style.transform+=`scale( ${a.view.fullWidth/a.view.width}, ${a.view.fullHeight/a.view.height} )`):g.style.transform="",m.matrixWorldAutoUpdate===!0&&m.updateMatrixWorld(),a.parent===null&&a.matrixWorldAutoUpdate===!0&&a.updateMatrixWorld();let L,C;a.isOrthographicCamera&&(L=-(a.right+a.left)/2,C=(a.top+a.bottom)/2);const D=a.view&&a.view.enabled?a.view.height/a.view.fullHeight:1,B=a.isOrthographicCamera?`scale( ${D} )scale(`+O+")translate("+d(L)+"px,"+d(C)+"px)"+S(a.matrixWorldInverse):`scale( ${D} )translateZ(`+O+"px)"+S(a.matrixWorldInverse),F=(a.isPerspectiveCamera?"perspective("+O+"px) ":"")+B+"translate("+o+"px,"+n+"px)";c.camera.style!==F&&(x.style.transform=F,c.camera.style=F),Y(m,m,a)},this.setSize=function(m,a){i=m,t=a,o=i/2,n=t/2,u.style.width=m+"px",u.style.height=a+"px",g.style.width=m+"px",g.style.height=a+"px",x.style.width=m+"px",x.style.height=a+"px"};function d(m){return Math.abs(m)<1e-10?0:m}function S(m){const a=m.elements;return"matrix3d("+d(a[0])+","+d(-a[1])+","+d(a[2])+","+d(a[3])+","+d(a[4])+","+d(-a[5])+","+d(a[6])+","+d(a[7])+","+d(a[8])+","+d(-a[9])+","+d(a[10])+","+d(a[11])+","+d(a[12])+","+d(-a[13])+","+d(a[14])+","+d(a[15])+")"}function A(m){const a=m.elements;return"translate(-50%,-50%)"+("matrix3d("+d(a[0])+","+d(a[1])+","+d(a[2])+","+d(a[3])+","+d(-a[4])+","+d(-a[5])+","+d(-a[6])+","+d(-a[7])+","+d(a[8])+","+d(a[9])+","+d(a[10])+","+d(a[11])+","+d(a[12])+","+d(a[13])+","+d(a[14])+","+d(a[15])+")")}function Y(m,a,O,L){if(m.isCSS3DObject){const C=m.visible===!0&&m.layers.test(O.layers)===!0;if(m.element.style.display=C===!0?"":"none",C===!0){m.onBeforeRender(s,a,O);let D;m.isCSS3DSprite?(E.copy(O.matrixWorldInverse),E.transpose(),m.rotation2D!==0&&E.multiply(vs.makeRotationZ(m.rotation2D)),m.matrixWorld.decompose(Be,bs,Fe),E.setPosition(Be),E.scale(Fe),E.elements[3]=0,E.elements[7]=0,E.elements[11]=0,E.elements[15]=1,D=A(E)):D=A(m.matrixWorld);const B=m.element,he=c.objects.get(m);if(he===void 0||he.style!==D){B.style.transform=D;const F={style:D};c.objects.set(m,F)}B.parentNode!==x&&x.appendChild(B),m.onAfterRender(s,a,O)}}for(let C=0,D=m.children.length;C<D;C++)Y(m.children[C],a,O)}}}var xs=Object.defineProperty,Os=Object.getOwnPropertyDescriptor,re=(r,e,s,i)=>{for(var t=i>1?void 0:i?Os(e,s):e,o=r.length-1,n;o>=0;o--)(n=r[o])&&(t=(i?n(e,s,t):n(t))||t);return i&&t&&xs(e,s,t),t};class X extends h{constructor(){super(...arguments),this.url="https://www.youtube.com/embed/puWNRrG4MCg",this.pixelsPerUnit=500,this.borderRadius=50,this.animator=null,this.rotate90=new W().setFromAxisAngle(new M(0,1,0),Math.PI)}start(){const e=N("url");e&&(this.url=e);const s=document.createElement("div");s.innerHTML='<iframe width="1000" height="1000" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; xr-spatial-tracking; xr" allowfullscreen></iframe>',s.style.zIndex="10000",s.style.position="absolute",s.style.pointerEvents="initial";const i=s.querySelector("iframe");i.addEventListener("load",()=>{setTimeout(()=>{var u;console.log("Automatically opening iframe"),(u=this.animator)==null||u.SetBool("Open",!0)},1e3)}),i.src=this.url;let t=1e3;const o=Math.round(this.gameObject.scale.x*this.pixelsPerUnit),n=Math.round(this.gameObject.scale.y*this.pixelsPerUnit);t=Math.max(o,n),i.width=o+"px",i.height=n+"px",s.style.position="absolute",this.borderRadius>0&&(s.style.borderRadius=this.borderRadius+"px"),s.style.pointerEvents="initial",document.body.append(s),this.cssRenderer=new _s,this.cssRenderer.domElement.style.pointerEvents="none",this.cssRenderer.domElement.style.position="absolute",this.cssRenderer.domElement.style.top="0px",document.body.append(this.cssRenderer.domElement),this.cssScene=new zt;const c=new ws(s);c.scale.setScalar(Math.max(this.gameObject.scale.x,this.gameObject.scale.y)/t),J(c,de(this.gameObject)),$e(c,Ae(this.gameObject)),c.quaternion.multiply(this.rotate90),this.cssScene.add(c),this.cssObj=c,this.context.post_render_callbacks.push(this.onPostRender.bind(this))}onPostRender(){if(!this.cssObj||!this.cssRenderer||!this.cssScene)return;J(this.cssObj,de(this.gameObject)),$e(this.cssObj,Ae(this.gameObject)),this.cssObj.quaternion.multiply(this.rotate90);const e=this.context.mainCamera,s=this.gameObject;var i=e.position.clone().sub(this.gameObject.position).normalize(),t=s.getWorldDirection(new M);const o=i.dot(t);this.cssObj.visible=o<.15;const n=this.cssRenderer.getSize();(n.width!==this.context.domWidth||n.height!==this.context.domHeight)&&this.cssRenderer.setSize(this.context.domWidth,this.context.domHeight),this.cssRenderer.render(this.cssScene,this.context.mainCamera)}}re([f()],X.prototype,"url",2);re([f()],X.prototype,"pixelsPerUnit",2);re([f()],X.prototype,"borderRadius",2);re([f(Ue)],X.prototype,"animator",2);class Ps extends h{constructor(){super(...arguments),this._ui=null}awake(){const e=y.findObjectsOfType(St),s=document.createElement("div");s.style.cssText=`
            position: absolute;
            top: 1em;
            left: 1em;
            line-height: 1.5em;
            display: block;
            width: 200px;
        `,this.context.domElement.appendChild(s),this._ui=s;const i=document.createElement("h2");i.style.cssText=`
            margin-bottom: .7em;
        `,i.innerText="Sample Images",s.appendChild(i);const t=document.createElement("p");t.innerHTML=`Download the image and print it or you can also open the image in your browser
        <br><strong>Then enter AR and scan it with your camera.</strong>
        <br>Visit our <a target="_blank" href="https://docs.needle.tools/image-tracking">ImageTracking documentation</a> for more information.
        `,t.style.userSelect="all",s.appendChild(t);for(const o of e)this.createDownloadImageUI(o,s)}update(){var e;this.context.isInAR?(e=this._ui)==null||e.remove():this._ui&&!this._ui.parentNode&&this.context.domElement.appendChild(this._ui)}createDownloadImageUI(e,s){if(e.trackedImages)for(const i of e.trackedImages){if(!i.image)continue;const t=document.createElement("a");t.href=i.image,s.appendChild(t);const o=document.createElement("img");o.src=i.image,o.style.cssText=`
                min-width: 180px;
                max-width: 220px;
                width: 15vw;
                height: auto;
                aspect-ratio: 1.3;
                object-fit: cover;
                background: rgba(0,0,0,0.5);
                border-radius: 10px;
                border: 2px solid rgba(255,255,255,1);
                box-shadow: 0 0 10px rgba(0,0,0,.2);
                margin-left: -.5em;
            `,t.appendChild(o)}}}var Cs=Object.defineProperty,js=Object.getOwnPropertyDescriptor,ae=(r,e,s,i)=>{for(var t=i>1?void 0:i?js(e,s):e,o=r.length-1,n;o>=0;o--)(n=r[o])&&(t=(i?n(e,s,t):n(t))||t);return i&&t&&Cs(e,s,t),t};class me extends h{onColorChanged(){typeof this.color=="number"&&(this.color=new Z(this.color)),this.setColorToMaterials()}onPointerClick(e){const s=new Z(Math.random(),Math.random(),Math.random());this.color=s}onEnable(){this.setColorToMaterials()}setColorToMaterials(){var s;const e=this.gameObject.getComponent(V);if(e)for(let i=0;i<e.sharedMaterials.length;i++){const t=(s=e.sharedMaterials[i])==null?void 0:s.clone();e.sharedMaterials[i]=t,t&&"color"in t&&(t.color=this.color)}else console.warn("No renderer found",this.gameObject)}}ae([U(me.prototype.onColorChanged),l(Z)],me.prototype,"color",2);class ue extends h{constructor(){super(...arguments),this.myArray=[],this.updateArray=()=>{const e=new Date().toLocaleTimeString();console.log("> Update array",e),this.myArray.length>10&&(console.log("Clearing array because we have reached 10 entries"),this.myArray.length=0),this.myArray.push(e),this.myArray=this.myArray,j('<strong>> Sent</strong> "'+e+'", we now have '+this.myArray.length+" elements")}}awake(){j("Open this window in another browser tab/window to see the networking in action..."),this.context.connection.beginListen(ye.JoinedRoom,async()=>{console.log("Will append a new value every 10 seconds"),setInterval(this.updateArray,1e4),await z(100),this.updateArray()})}onArrayChanged(){console.log("< Received array",this.myArray[this.myArray.length-1],this.myArray),j('<strong>< Received</strong> "'+this.myArray[this.myArray.length-1]+'", we now have '+this.myArray.length+" elements")}}ae([U(ue.prototype.onArrayChanged)],ue.prototype,"myArray",2);class Ss{constructor(){this.name="",this.age=0}}class k extends h{constructor(){super(...arguments),this.myObject=new Ss,this._mockAge=0,this.updateObject=()=>{this.myObject.name=this.context.connection.connectionId,this._mockAge+=1,this.myObject.age=this._mockAge,this.myObject=this.myObject,console.log("> Updated",this.myObject),j('<strong>> Sent</strong> "'+this.myObject.name+'" is '+this.myObject.age+" years old")}}awake(){j("Open this window in another browser tab/window to see the networking in action..."),this.context.connection.beginListen(ye.JoinedRoom,async()=>{await z(1),this.updateObject()})}onObjectChanged(){console.log("< Received object",this.myObject),j('<strong>< Received</strong> "'+this.myObject.name+'" is '+this.myObject.age+" years old")}}ae([U(k.prototype.onObjectChanged)],k.prototype,"myObject",2);ae([U()],k.prototype,"_mockAge",2);var Ds=Object.defineProperty,Es=Object.getOwnPropertyDescriptor,it=(r,e,s,i)=>{for(var t=i>1?void 0:i?Es(e,s):e,o=r.length-1,n;o>=0;o--)(n=r[o])&&(t=(i?n(e,s,t):n(t))||t);return i&&t&&Ds(e,s,t),t};class je extends h{constructor(){super(...arguments),this.clampFrameRate=!0,this._clampFrameRate=!1,this.maxFrameRate=72,this._maxFrameRate=-1024}update(){if(this._clampFrameRate!==this.clampFrameRate||this._maxFrameRate!==this.maxFrameRate){const e=this.clampFrameRate?this.maxFrameRate:void 0;this.context.targetFrameRate=e,this._clampFrameRate=this.clampFrameRate,this._maxFrameRate=this.maxFrameRate}}setTarget(e){this.maxFrameRate=e,this.clampFrameRate=!0}setClamping(e){this.clampFrameRate=e}}it([l()],je.prototype,"clampFrameRate",2);it([l()],je.prototype,"maxFrameRate",2);var Rs=Object.defineProperty,Ms=Object.getOwnPropertyDescriptor,$=(r,e,s,i)=>{for(var t=i>1?void 0:i?Ms(e,s):e,o=r.length-1,n;o>=0;o--)(n=r[o])&&(t=(i?n(e,s,t):n(t))||t);return i&&t&&Rs(e,s,t),t};class G extends h{constructor(){super(...arguments),this.logEvents=!1}onCollisionEnter(e){var s;this.logEvents&&console.log("ENTER",e),(s=this.onEnter)==null||s.invoke(e)}onCollisionStay(e){var s;this.logEvents&&console.log("STAY",e),(s=this.onStay)==null||s.invoke(e)}onCollisionExit(e){var s;this.logEvents&&console.log("EXIT",e),(s=this.onExit)==null||s.invoke(e)}}$([f(v)],G.prototype,"onEnter",2);$([f(v)],G.prototype,"onStay",2);$([f(v)],G.prototype,"onExit",2);$([f()],G.prototype,"logEvents",2);class q extends h{onTriggerEnter(e){var s,i;this.triggerObjects&&this.triggerObjects.length>0&&!((s=this.triggerObjects)!=null&&s.includes(e.gameObject))||(i=this.onEnter)==null||i.invoke()}onTriggerStay(e){var s,i;this.triggerObjects&&this.triggerObjects.length>0&&!((s=this.triggerObjects)!=null&&s.includes(e.gameObject))||(i=this.onStay)==null||i.invoke()}onTriggerExit(e){var s,i;this.triggerObjects&&this.triggerObjects.length>0&&!((s=this.triggerObjects)!=null&&s.includes(e.gameObject))||(i=this.onExit)==null||i.invoke()}}$([f(y)],q.prototype,"triggerObjects",2);$([f(v)],q.prototype,"onEnter",2);$([f(v)],q.prototype,"onStay",2);$([f(v)],q.prototype,"onExit",2);var Ts=Object.defineProperty,$s=Object.getOwnPropertyDescriptor,As=(r,e,s,i)=>{for(var t=i>1?void 0:i?$s(e,s):e,o=r.length-1,n;o>=0;o--)(n=r[o])&&(t=(i?n(e,s,t):n(t))||t);return i&&t&&Ts(e,s,t),t};class ot extends h{constructor(){super(...arguments),this._lastTriggerTime=0}onTriggerEnter(e){this.context.time.time-this._lastTriggerTime<.3||(this._lastTriggerTime=this.context.time.time,this.animation&&this.animation.play(0,{loop:!1}))}onTriggerExit(){}}As([f(be)],ot.prototype,"animation",2);var Is=Object.defineProperty,Ls=Object.getOwnPropertyDescriptor,Bs=(r,e,s,i)=>{for(var t=i>1?void 0:i?Ls(e,s):e,o=r.length-1,n;o>=0;o--)(n=r[o])&&(t=(i?n(e,s,t):n(t))||t);return i&&t&&Is(e,s,t),t};class nt extends h{onTriggerEnter(){var e,s;(e=this.animation)!=null&&e.isPlaying||(s=this.animation)==null||s.play(0,{loop:!1})}}Bs([f(be)],nt.prototype,"animation",2);var Fs=Object.defineProperty,Ws=Object.getOwnPropertyDescriptor,Vs=(r,e,s,i)=>{for(var t=i>1?void 0:i?Ws(e,s):e,o=r.length-1,n;o>=0;o--)(n=r[o])&&(t=(i?n(e,s,t):n(t))||t);return i&&t&&Fs(e,s,t),t};class rt extends h{onCollisionEnter(){var e,s;(e=this.audioSource)==null||e.stop(),(s=this.audioSource)==null||s.play()}}Vs([f(ge)],rt.prototype,"audioSource",2);var zs=Object.defineProperty,Ns=Object.getOwnPropertyDescriptor,at=(r,e,s,i)=>{for(var t=i>1?void 0:i?Ns(e,s):e,o=r.length-1,n;o>=0;o--)(n=r[o])&&(t=(i?n(e,s,t):n(t))||t);return i&&t&&zs(e,s,t),t};class Se extends h{constructor(){super(...arguments),this.referenceSize=512,this.updateSize=()=>{if(this.content){if(this.referenceSize<=0)return console.error("ResponsiveContent: Base width must be greater than 0.");const e=this.context.domWidth/this.referenceSize;this.content.scale.set(e,e,e)}else K()&&console.warn("ResponsiveContent: No content object set.")}}onEnable(){window.addEventListener("resize",this.updateSize),this.updateSize()}onDisable(){window.removeEventListener("resize",this.updateSize)}}at([l(T)],Se.prototype,"content",2);at([l()],Se.prototype,"referenceSize",2);var Us=Object.defineProperty,Hs=Object.getOwnPropertyDescriptor,De=(r,e,s,i)=>{for(var t=i>1?void 0:i?Hs(e,s):e,o=r.length-1,n;o>=0;o--)(n=r[o])&&(t=(i?n(e,s,t):n(t))||t);return i&&t&&Us(e,s,t),t};class lt extends h{async sceneOpened(){var e;(e=this.animator)==null||e.setBool("SceneOpen",!0),this._htmlElement=this._getHtmlElement(),this.context.domElement.appendChild(this._htmlElement)}async sceneClosing(){var e,s;await z(1e3),(e=this.animator)==null||e.setBool("SceneOpen",!1),await z(1e3),(s=this._htmlElement)==null||s.remove()}_getHtmlElement(){if(!this._htmlElement){this._htmlElement=document.createElement("div"),this._htmlElement.style.cssText=`
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                display: flex;
                justify-content: center;
                align-items: center;
                // backdrop-filter: blur(10px);
            `;const e=document.createElement("img");e.src="https://engine.needle.tools/branding/needle-logo.png",this._htmlElement.appendChild(e)}return this._htmlElement}}De([l(Ue)],lt.prototype,"animator",2);class Ee extends h{sceneOpened(){var e;return K()&&console.log("Scene opened",this.name),(e=this.opened)==null||e.invoke(),Promise.resolve()}sceneClosing(){var e;return K()&&console.log("Scene closing",this.name),(e=this.closing)==null||e.invoke(),Promise.resolve()}}De([l(v)],Ee.prototype,"opened",2);De([l(v)],Ee.prototype,"closing",2);class Xs extends h{next(){var e;this.switcher??(this.switcher=this.get()),console.log(this.switcher),(e=this.switcher)==null||e.selectNext()}previous(){var e;this.switcher??(this.switcher=this.get()),(e=this.switcher)==null||e.selectPrev()}get(){return y.findObjectOfType(Dt)}}var Gs=Object.defineProperty,qs=Object.getOwnPropertyDescriptor,Qs=(r,e,s,i)=>{for(var t=i>1?void 0:i?qs(e,s):e,o=r.length-1,n;o>=0;o--)(n=r[o])&&(t=(i?n(e,s,t):n(t))||t);return i&&t&&Gs(e,s,t),t};class ct extends h{constructor(){super(...arguments),this.text=""}start(){j(this.text)}}Qs([l()],ct.prototype,"text",2);var Ys=Object.defineProperty,Js=Object.getOwnPropertyDescriptor,Ks=(r,e,s,i)=>{for(var t=i>1?void 0:i?Js(e,s):e,o=r.length-1,n;o>=0;o--)(n=r[o])&&(t=(i?n(e,s,t):n(t))||t);return i&&t&&Ys(e,s,t),t};const Zs=N("testleaderboard");class fe extends h{constructor(){super(...arguments),this._ready=!1}get ready(){return this._ready}onEnable(){this.context.connection.beginListen(ye.JoinedRoom,async()=>{await z(100),this.context.connection.tryGetState(this.guid)||(this.data={scores:[]}),this._ready=!0}),Zs?(console.log("Enabled test leaderboard, adding random scores"),setInterval(()=>{this.insertScore("Player",Math.floor(Math.random()*1e3))},2e3)):K()&&j("You can add ?testleaderboard to the url to test the leaderboard")}insertScore(e,s){if(!this._ready){console.warn("Cannot insert score, data not received yet");return}const i=10,t=this.data.scores;for(;t.length>=i;){this.sortScores();const o=t.pop();if(o.score>s){console.log(`Score ${s} is lower than ${o==null?void 0:o.score} (lowest score), ignoring`),t.push(o);return}}console.log("Inserting score",e,s),t.push({name:e,score:s}),this.sortScores(),this.data=this.data}sortScores(){this.data.scores.sort((e,s)=>s.score-e.score)}onDataChanged(e){if(console.warn("Data changed!",e,this.data.scores),this.data.scores.length>0){const s=this.data.scores[0];j("HIGHSCORE - "+s.name+": "+s.score)}this.dispatchEvent(new CustomEvent("changed",{detail:this.data}))}}Ks([U(fe.prototype.onDataChanged)],fe.prototype,"data",2);var ks=Object.defineProperty,ei=Object.getOwnPropertyDescriptor,ti=(r,e,s,i)=>{for(var t=i>1?void 0:i?ei(e,s):e,o=r.length-1,n;o>=0;o--)(n=r[o])&&(t=(i?n(e,s,t):n(t))||t);return i&&t&&ks(e,s,t),t};class ht extends h{start(){this.updateStartPosition()}updateStartPosition(){this.startPosition=this.gameObject.position.clone()}resetToStart(){if(!this.startPosition)return;const e=y.getComponent(this.gameObject,R);e==null||e.teleport(this.startPosition)}}class pt extends ht{start(){super.start(),this.worldCollider||console.warn("Missing collider to reset",this)}onTriggerExit(e){e===this.worldCollider&&this.resetToStart()}}ti([f(te)],pt.prototype,"worldCollider",2);var si=Object.defineProperty,ii=Object.getOwnPropertyDescriptor,oi=(r,e,s,i)=>{for(var t=i>1?void 0:i?ii(e,s):e,o=r.length-1,n;o>=0;o--)(n=r[o])&&(t=(i?n(e,s,t):n(t))||t);return i&&t&&si(e,s,t),t};class dt extends h{constructor(){super(...arguments),this.roomId="",this.playerCount=0}update(){const e=this.context.connection;let s=!1;e.currentRoomName&&e.currentRoomName!==this.roomId&&(this.roomId=e.currentRoomName,s=!0),e.usersInRoom().length!==this.playerCount&&(this.playerCount=e.usersInRoom().length,s=!0),s&&this.connectionLabel&&(this.connectionLabel.text=`Room: ${this.roomId}
Users: ${this.playerCount}
Your id: ${e.connectionId}`)}}oi([l(ee)],dt.prototype,"connectionLabel",2);var ni=Object.defineProperty,ri=Object.getOwnPropertyDescriptor,ai=(r,e,s,i)=>{for(var t=i>1?void 0:i?ri(e,s):e,o=r.length-1,n;o>=0;o--)(n=r[o])&&(t=(i?n(e,s,t):n(t))||t);return i&&t&&ni(e,s,t),t};class mt extends h{constructor(){super(...arguments),this.interval=1e3,this.max=100,this.spawned=0}awake(){if(!this.object){console.warn("TimedSpawn: no object to spawn"),j("TimedSpawn: no object to spawn",Et.Warn);return}y.setActive(this.object,!1),this.startCoroutine(this.spawn())}*spawn(){if(this.object)for(;this.spawned<this.max;){const e=y.instantiate(this.object);y.setActive(e,!0),this.spawned+=1,yield Rt(this.interval/1e3)}}}ai([f(y)],mt.prototype,"object",2);class li extends h{async awake(){const e=document.createElement("video");e.style.cssText=`
            position: fixed;
            min-width: 100%;
            min-height: 100%;
            z-index: -1;
        `,this.context.domElement.shadowRoot.appendChild(e);const s=await navigator.mediaDevices.getUserMedia({video:!0});if(!s)return;e.srcObject=s,e.play();const i=this.context.mainCameraComponent;i&&(i.clearFlags=Mt.SolidColor,i.backgroundColor=new Tt(125,125,125,0))}}var ci=Object.defineProperty,hi=Object.getOwnPropertyDescriptor,le=(r,e,s,i)=>{for(var t=i>1?void 0:i?hi(e,s):e,o=r.length-1,n;o>=0;o--)(n=r[o])&&(t=(i?n(e,s,t):n(t))||t);return i&&t&&ci(e,s,t),t};class Q extends h{constructor(){super(...arguments),this.interval=3,this.resetPosition=!0,this.resetRotation=!1,this.resetVelocity=!1}start(){const e=this.gameObject.position.clone(),s=this.gameObject.rotation.clone(),i=this.gameObject.getComponent(R),t=this.context.time.frame;setInterval(()=>{this.resetPosition&&this.gameObject.position.copy(e),this.resetRotation&&this.gameObject.rotation.copy(s),i&&this.resetVelocity&&this.context.time.frame!==t&&i.resetVelocities()},this.interval*1e3)}}le([l()],Q.prototype,"interval",2);le([l()],Q.prototype,"resetPosition",2);le([l()],Q.prototype,"resetRotation",2);le([l()],Q.prototype,"resetVelocity",2);class pi extends h{constructor(){super(...arguments),this.toggleRendererOnly=!1}start(){setInterval(()=>{if(j('This is a sample for showing how to <a href="https://engine.needle.tools/docs/scripting.html#component-architecture" target="_blank">toggle visibility of a GameObject</a>'),this.toggleRendererOnly){const e=this.gameObject.getComponent(V);e&&(e.enabled=!e.enabled)}else this.gameObject.visible=!this.gameObject.visible},1e3)}}var di=Object.defineProperty,mi=Object.getOwnPropertyDescriptor,ui=(r,e,s,i)=>{for(var t=i>1?void 0:i?mi(e,s):e,o=r.length-1,n;o>=0;o--)(n=r[o])&&(t=(i?n(e,s,t):n(t))||t);return i&&t&&di(e,s,t),t};class ut extends h{awake(){this.material&&(this.material.wireframe=!0)}}ui([l(qe)],ut.prototype,"material",2);var fi=Object.defineProperty,gi=Object.getOwnPropertyDescriptor,ft=(r,e,s,i)=>{for(var t=i>1?void 0:i?gi(e,s):e,o=r.length-1,n;o>=0;o--)(n=r[o])&&(t=(i?n(e,s,t):n(t))||t);return i&&t&&fi(e,s,t),t};class Re extends h{constructor(){super(...arguments),this.onSessionStart=new v,this.onSessionEnd=new v}onEnterXR(e){this.onWebXRStarted()}onExitXR(e){this.onWebXREnded()}onWebXRStarted(){Ie(this.context.scene,!1),this.onSessionStart.invoke()}onWebXREnded(){Ie(this.context.scene,!1),this.onSessionEnd.invoke()}}ft([l(v)],Re.prototype,"onSessionStart",2);ft([l(v)],Re.prototype,"onSessionEnd",2);class gt extends h{constructor(){super(...arguments),this.destroyTarget=!1,this._startTime=0}awake(){if(this._rigidbody=this.gameObject.getComponentInParent(R)||void 0,this._rigidbody){const e=this.gameObject.getComponentsInChildren(te);for(const s of e){const i=y.addComponent(s.gameObject,yi);i.rigidBody=this._rigidbody,i.arrow=this,i.destroyTarget=this.destroyTarget}}this._startTime=this.context.time.time}onBeforeRender(){if(this.context.time.time-this._startTime>5){this.gameObject.destroy();return}if(this._rigidbody){const e=this._rigidbody.getVelocity();if(e.lengthSq()>0){const s=P().set(e.x,e.y,e.z).normalize(),i=He();i.setFromUnitVectors(P(0,0,1),s),this.gameObject.quaternion.copy(i)}}}}class yi extends h{constructor(){super(...arguments),this.destroyTarget=!1}onCollisionEnter(e){if(this.arrow)if(this.destroyTarget)e.gameObject.destroy(),this.arrow.gameObject.destroy();else{e.gameObject.attach(this.arrow.gameObject),e.rigidBody instanceof R&&e.rigidBody.applyImpulse(e.gameObject.position.clone().multiply(this.rigidBody.getVelocity()),!0);const s=this.rigidBody.gameObject.getComponentsInChildren(te);for(const i of s)i.destroy();this.rigidBody.destroy(),this.arrow.destroy()}}}var bi=Object.defineProperty,wi=Object.getOwnPropertyDescriptor,_=(r,e,s,i)=>{for(var t=i>1?void 0:i?wi(e,s):e,o=r.length-1,n;o>=0;o--)(n=r[o])&&(t=(i?n(e,s,t):n(t))||t);return i&&t&&bi(e,s,t),t};const vi=N("debugarrow");class b extends h{constructor(){super(...arguments),this.power=1.5,this.drawMaxPhysicalDistance=.47269,this.drawMinPhysicalDistance=.1132593,this.desktopIdleDrawAmount=.25,this.interactionPixelOrigin=new I(.5,.65),this.interactionPixelTreshold=85,this.drawMaxPixelDistance=100,this._isAiming=!1,this._aimingPointerStartPos=new I(0,0),this._bowController=void 0,this._stringController=void 0,this.onDown=e=>{var s;if(e.origin instanceof Le){if(e.button===0){this._isAiming=!0,this._bowController===void 0?this._bowController=e.origin.index:this._stringController===void 0&&(this._stringController=e.origin.index);const i=(s=this.bowObject)==null?void 0:s.getComponentInParent(It);i&&(i.side=this._bowController)}}else e.button===0&&(this.getPointerDinstanceTo(this._aimingPointerStartPos,e.pointerId),this._isAiming=!0,this._aimingPointerId=e.pointerId)},this.onRelease=e=>{var s;if(e.button===0&&this._isAiming){if(this._isAiming=!1,this._aimingPointerId=void 0,e.origin instanceof Le){const i=e.origin;if(i.index===this._stringController&&this._bowController!==void 0){const t=(s=Ve.active)==null?void 0:s.getController(this._bowController);if(i&&t){const o=i.gripWorldPosition;if(o){const n=t.gripWorldPosition.clone().sub(o);let c=t.object.worldPosition.distanceTo(i.object.worldPosition);c-=this.drawMinPhysicalDistance;const u=w.clamp01(c/this.drawMaxPhysicalDistance);n.normalize().multiplyScalar(u*this.power),this.shoot(o,n),vi&&ze.DrawArrow(o,n.clone().add(o),16776960,1)}}}i.index===this._bowController&&(this._bowController=void 0),i.index===this._stringController&&(this._stringController=void 0)}else if(this.arrowSpawnSpot){const i=this.arrowSpawnSpot.getWorldPosition(P()),t=this.gameObject.getWorldDirection(P()),o=this.getPointerDinstanceTo(this._aimingPointerStartPos,e.pointerId),n=w.clamp01(o/this.drawMaxPixelDistance)*this.power;t.multiplyScalar(n),o>this.interactionPixelTreshold&&this.shoot(i,t)}}},this.shotStamp=Number.MIN_SAFE_INTEGER,this.fakeArrowRespawnDuration=.3,this._initRot=new W,this._tempLookMatrix=new we,this._tempLookRot=new W,this._rotate90=new W().setFromAxisAngle(new M(0,0,1),Math.PI/2),this.tempDir=new I,this.tempUpRef=new I}awake(){var e;(e=this.arrowPrefab)!=null&&e.asset&&(this.arrowPrefab.asset.visible=!1),this.bowObject&&this._initRot.copy(this.bowObject.quaternion),this.nonMountedParent=this.gameObject.parent,this.mount()}onEnable(){var e;(e=this.arrowPrefab)==null||e.loadAssetAsync(),this._isAiming=!1,this.context.input.addEventListener("pointerdown",this.onDown),this.context.input.addEventListener("pointerup",this.onRelease),this.setupPreDraw()}onDisable(){this._isAiming=!1,this.context.input.removeEventListener("pointerdown",this.onDown),this.context.input.removeEventListener("pointerup",this.onRelease)}getPointerDinstanceTo(e,s){const i=this.context.input.getPointerPosition(s);return e.distanceTo(i)}async setupPreDraw(){var s,i;if(!this.arrowPrefab||!this.arrowSpawnSpot||this.fakeArrow)return;const e=await this.arrowPrefab.instantiate({parent:this.arrowSpawnSpot});e&&(e.visible=!0,e.worldScale=P(1,1,1),this.fakeArrow=e,(s=e.getComponent(gt))==null||s.destroy(),(i=e.getComponent(R))==null||i.destroy(),e.getComponentsInChildren(te).forEach(t=>t.destroy()))}async shoot(e,s){var g,x;if(!this.arrowPrefab)return;this.shotStamp=this.context.time.time;const i=e.clone(),t=i.clone().add(s),o=Math.pow(s.length()+.5,2),n=s.clone().normalize(),c=await this.arrowPrefab.instantiate({parent:this.context.scene});if(!c)return;c.worldPosition=i,c.lookAt(t),c.visible=!0;const u=c.getComponent(R);u&&(u.isKinematic=!1,u.autoMass=!1,u.mass=.05,(g=this.sound)==null||g.stop(),(x=this.sound)==null||x.play(),await Xe(1),u.applyImpulse(n.multiplyScalar(o),!0))}mount(){this.cameraParent&&(this.gameObject.parent=this.cameraParent,this.gameObject.position.set(0,0,0),this.gameObject.quaternion.set(0,0,0,1))}unmount(){this.gameObject.parent=this.nonMountedParent}get _hasControllers(){var e;return(((e=this.context.xr)==null?void 0:e.controllers.length)??0)>0}onEnterXR(e){(e.xr.isVR||e.xr.isPassThrough)&&this.unmount()}onLeaveXR(e){this.mount()}onBeforeRender(){if(!this.animationComponent||!this.bowObject)return;if(!this._mixer){this._mixer=new Nt(this.bowObject);const o=this.animationComponent.animations.at(0);o&&(this._animation=this._mixer.clipAction(o))}const e=.1;let s=0;if(this._hasControllers){if(!this._isAiming)s=0;else if(this.context.xr&&this.context.xr.controllers.length>1&&this._bowController!==void 0&&this._stringController!==void 0){const o=this.context.xr.controllers[this._stringController],n=this.context.xr.controllers[this._bowController];if(!o||!n)return;let c=P(0,1,0);!n.hand&&n.targetRayMode==="tracked-pointer"&&c.applyQuaternion(this._rotate90),c.applyQuaternion(n.gripWorldQuaternion).normalize(),this._tempLookMatrix.lookAt(o.gripWorldPosition,n.gripWorldPosition,c),this._tempLookRot.setFromRotationMatrix(this._tempLookMatrix),this.bowObject.worldQuaternion=this._tempLookRot;let u=o.object.worldPosition.distanceTo(n.object.worldPosition);u-=this.drawMinPhysicalDistance,s=w.clamp01(u/this.drawMaxPhysicalDistance)}}else{const o=this.interactionPixelOrigin;if(this._aimingPointerStartPos.set(this.context.domWidth*o.x,this.context.domHeight*o.y),!this._isAiming)s=this.desktopIdleDrawAmount;else{const n=this.context.input;if(this._aimingPointerId!=null){const c=this._aimingPointerStartPos,u=n.getPointerPosition(this._aimingPointerId),g=this.tempDir.copy(u).sub(c),d=g.length(),S=P();S.x=g.x,S.z=g.y,S.normalize();const A=this.gameObject.getWorldDirection(P());A.y=0,A.normalize();const Y=S.dot(A),m=d>this.interactionPixelTreshold;(Y>0||m)&&(s=w.clamp01(d/this.drawMaxPixelDistance)),this.tempUpRef.set(1,0);const O=this.tempUpRef.dot(g)>0?-1:1;this.tempUpRef.set(0,1);const L=this.tempUpRef.angleTo(g)*O;if(m){const C=He().setFromAxisAngle(P().set(1,0,0),L);this.gameObject.quaternion.slerp(C,this.context.time.deltaTime/.05)}}}}this.drawProgression&&(s=this.drawProgression.evaluate(s)),this._animation.timeScale=0;const i=w.lerp(this._animation.time,s,this.context.time.deltaTime/e),t=this._animation.time;if(this._animation.time=i,Math.abs(i-t)>Number.EPSILON&&(this._animation.setEffectiveWeight(1),this._animation.play()),this._mixer.update(this.context.time.deltaTime),this.fakeArrow){let o=(this.context.time.time-this.shotStamp)/this.fakeArrowRespawnDuration;o=this.easeInOutSine(w.clamp01(o)),this.fakeArrow.worldScale=P(1,1,1).multiplyScalar(o)}}easeInOutSine(e){return w.clamp01(-.5*(Math.cos(Math.PI*e)-1))}}_([l()],b.prototype,"power",2);_([l()],b.prototype,"drawMaxPhysicalDistance",2);_([l()],b.prototype,"drawMinPhysicalDistance",2);_([l($t)],b.prototype,"drawProgression",2);_([l(T)],b.prototype,"cameraParent",2);_([l()],b.prototype,"desktopIdleDrawAmount",2);_([l(I)],b.prototype,"interactionPixelOrigin",2);_([l()],b.prototype,"interactionPixelTreshold",2);_([l()],b.prototype,"drawMaxPixelDistance",2);_([l(T)],b.prototype,"bowObject",2);_([l(be)],b.prototype,"animationComponent",2);_([l(At)],b.prototype,"arrowPrefab",2);_([l(T)],b.prototype,"arrowSpawnSpot",2);_([l(ge)],b.prototype,"sound",2);_([l()],b.prototype,"fakeArrowRespawnDuration",2);var _i=Object.defineProperty,xi=Object.getOwnPropertyDescriptor,Oi=(r,e,s,i)=>{for(var t=i>1?void 0:i?xi(e,s):e,o=r.length-1,n;o>=0;o--)(n=r[o])&&(t=(i?n(e,s,t):n(t))||t);return i&&t&&_i(e,s,t),t};class yt extends h{start(){this._meshRenderer=this.gameObject.getComponentInChildren(Lt)}onDestroy(){if(this.particleSystem){if(this.particleSystem.shape.shapeType===pe.MeshRenderer&&this._meshRenderer&&!Ge(this._meshRenderer.gameObject)){this.particleSystem.shape.shapeType=pe.MeshRenderer,this.particleSystem.shape.setMesh(this._meshRenderer),this.particleSystem.play();return}this.particleSystem.shape.shapeType=pe.Sphere,this.particleSystem.worldPosition=this.gameObject.worldPosition,this.particleSystem.play()}}}Oi([l(Ne)],yt.prototype,"particleSystem",2);var Pi=Object.defineProperty,Ci=Object.getOwnPropertyDescriptor,ji=(r,e,s,i)=>{for(var t=i>1?void 0:i?Ci(e,s):e,o=r.length-1,n;o>=0;o--)(n=r[o])&&(t=(i?n(e,s,t):n(t))||t);return i&&t&&Pi(e,s,t),t};class bt extends h{constructor(){super(...arguments),this._instances=new Array}awake(){var e,s;if(!((e=this.prefabs)!=null&&e.length)||((s=this.prefabs)==null?void 0:s.length)===0){console.warn("BowTargetSpawner start: no prefab set"),this.enabled=!1;return}this.prefabs.forEach(i=>i.visible=!1)}update(){var s;if(!((s=this.prefabs)!=null&&s.length))return;const e=P();for(let i=this._instances.length-1;i>=0;i--){const t=this._instances[i];Ge(t.instance)?this._instances.splice(i,1):(e.setScalar(t.scale),t.instance.scale.lerp(e,this.context.time.deltaTime))}if(this.context.time.frame%20===0&&Math.random()>.5){const i=this.worldPosition;i.x+=Math.random()*12-6,i.y+=Math.random()*3,i.z+=Math.random()*6;const t=Math.random()*3+.5,o=this.prefabs[Math.floor(Math.random()*this.prefabs.length)],n=Bt(o,{parent:this.scene,position:i.clone(),scale:new M(.01,.01,.01),keepWorldPosition:!0});n.visible=!0,this._instances.push({instance:n,scale:t}),setTimeout(()=>{n.destroy()},7e3),Xe(1).then(()=>{const c=n.getComponentInChildren(R);c&&(c.gravityScale=.2+Math.random()*.3,c.mass=2,c.autoMass=!1),c==null||c.setAngularVelocity(w.random(-2,2),w.random(-2,2),w.random(-2,2)),c==null||c.applyImpulse({x:0,y:5+Math.random()*12,z:0})})}}}ji([l(T)],bt.prototype,"prefabs",2);var Si=Object.defineProperty,Di=Object.getOwnPropertyDescriptor,Ei=(r,e,s,i)=>{for(var t=i>1?void 0:i?Di(e,s):e,o=r.length-1,n;o>=0;o--)(n=r[o])&&(t=(i?n(e,s,t):n(t))||t);return i&&t&&Si(e,s,t),t};class Me extends h{constructor(){super(...arguments),this.displayName=""}}Ei([l()],Me.prototype,"displayName",2);var Ri=Object.defineProperty,Mi=Object.getOwnPropertyDescriptor,Te=(r,e,s,i)=>{for(var t=i>1?void 0:i?Mi(e,s):e,o=r.length-1,n;o>=0;o--)(n=r[o])&&(t=(i?n(e,s,t):n(t))||t);return i&&t&&Ri(e,s,t),t};class ce extends h{constructor(){super(...arguments),this.objects=[],this.hideContentOnStart=!0,this.index=-1}awake(){this.hideContentOnStart||(this.index=0),this.apply()}next(){this.index++,this.index>=this.objects.length&&(this.index=0),this.apply()}previous(){this.index--,this.index<0&&(this.index=this.objects.length-1),this.apply()}apply(){for(let e=0;e<this.objects.length;e++)this.objects[e].visible=e===this.index;if(this.lable){const e=this.objects[this.index];if(e){const s=y.getComponent(e,Me);this.lable.text=(s==null?void 0:s.displayName)??e.name}}}select(e){this.index=e,this.index=w.clamp(this.index,0,this.objects.length-1),this.apply()}}Te([l(T)],ce.prototype,"objects",2);Te([l()],ce.prototype,"hideContentOnStart",2);Te([l(ee)],ce.prototype,"lable",2);p.add("AspectRatioFitterUI",ve);p.add("CameraGoal",se);p.add("CameraLayer",qt);p.add("Cannon",H);p.add("RandomColor",xe);p.add("ChangeColorOnCollision",Zt);p.add("IncreaseShaderSpeedOverTime",Je);p.add("DebugLOD",Oe);p.add("DepthOfFieldController",oe);p.add("DisableEnvironmentLight",rs);p.add("EmitParticlesOnClick",Ze);p.add("EnforceParameters",ke);p.add("HTMLButtonClick",Ce);p.add("HTMLMenu",ne);p.add("IFrameContent",X);p.add("ImageTrackingDownloadUI",Ps);p.add("Networking_ClickToChangeColor",me);p.add("Networking_StringArray",ue);p.add("Networking_Object",k);p.add("PerformanceSettings",je);p.add("PhysicsCollision",G);p.add("PhysicsTrigger",q);p.add("PlayAnimationOnCollision",ot);p.add("PlayAnimationOnTrigger",nt);p.add("PlayAudioOnCollision",rt);p.add("ResponsiveContent",Se);p.add("LoadingSceneRoot",lt);p.add("SceneLoadingEvents",Ee);p.add("SceneSwitcherControls",Xs);p.add("ShowBalloonMessage",ct);p.add("SimpleLeaderboard",fe);p.add("StartPosition",ht);p.add("AutoReset",pt);p.add("SyncedRoomUI",dt);p.add("TimedSpawn",mt);p.add("VideoBackground",li);p.add("ResetPositionOnInterval",Q);p.add("ToggleVisibility",pi);p.add("WireframeMaterial",ut);p.add("XRLifecycleEvents",Re);p.add("Arrow",gt);p.add("ArrowShooting",b);p.add("BowArrowTarget",yt);p.add("BowTargetSpawner",bt);p.add("VariantInfo",Me);p.add("VariantSwitcher",ce);
